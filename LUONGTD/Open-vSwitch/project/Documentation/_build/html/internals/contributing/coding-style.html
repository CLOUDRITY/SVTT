
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Open vSwitch Coding Style &#8212; Open vSwitch 2.9.2 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Open vSwitch Windows Datapath Coding Style" href="coding-style-windows.html" />
    <link rel="prev" title="Backporting patches" href="backporting-patches.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="open-vswitch-coding-style">
<h1>Open vSwitch Coding Style<a class="headerlink" href="#open-vswitch-coding-style" title="Permalink to this headline">¶</a></h1>
<p>This file describes the coding style used in most C files in the Open vSwitch
distribution. However, Linux kernel code datapath directory follows the Linux
kernel’s established coding conventions. For the Windows kernel datapath code,
use the coding style described in <a class="reference internal" href="coding-style-windows.html"><span class="doc">Open vSwitch Windows Datapath Coding Style</span></a>.</p>
<p>The following GNU indent options approximate this style.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">npro</span> <span class="o">-</span><span class="n">bad</span> <span class="o">-</span><span class="n">bap</span> <span class="o">-</span><span class="n">bbb</span> <span class="o">-</span><span class="n">br</span> <span class="o">-</span><span class="n">blf</span> <span class="o">-</span><span class="n">brs</span> <span class="o">-</span><span class="n">cdw</span> <span class="o">-</span><span class="n">ce</span> <span class="o">-</span><span class="n">fca</span> <span class="o">-</span><span class="n">cli0</span> <span class="o">-</span><span class="n">npcs</span> <span class="o">-</span><span class="n">i4</span> <span class="o">-</span><span class="n">l79</span> \
<span class="o">-</span><span class="n">lc79</span> <span class="o">-</span><span class="n">nbfda</span> <span class="o">-</span><span class="n">nut</span> <span class="o">-</span><span class="n">saf</span> <span class="o">-</span><span class="n">sai</span> <span class="o">-</span><span class="n">saw</span> <span class="o">-</span><span class="n">sbi4</span> <span class="o">-</span><span class="n">sc</span> <span class="o">-</span><span class="n">sob</span> <span class="o">-</span><span class="n">st</span> <span class="o">-</span><span class="n">ncdb</span> <span class="o">-</span><span class="n">pi4</span> <span class="o">-</span><span class="n">cs</span> <span class="o">-</span><span class="n">bs</span> \
<span class="o">-</span><span class="n">di1</span> <span class="o">-</span><span class="n">lp</span> <span class="o">-</span><span class="n">il0</span> <span class="o">-</span><span class="n">hnl</span>
</pre></div>
</div>
<div class="section" id="basics">
<span id="id1"></span><h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Limit lines to 79 characters.</li>
<li>Use form feeds (control+L) to divide long source files into logical pieces. A
form feed should appear as the only character on a line.</li>
<li>Do not use tabs for indentation.</li>
<li>Avoid trailing spaces on lines.</li>
</ul>
</div>
<div class="section" id="naming">
<span id="id2"></span><h2>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Use names that explain the purpose of a function or object.</li>
<li>Use underscores to separate words in an identifier: <code class="docutils literal notranslate"><span class="pre">multi_word_name</span></code>.</li>
<li>Use lowercase for most names. Use uppercase for macros, macro parameters,
and members of enumerations.</li>
<li>Give arrays names that are plural.</li>
<li>Pick a unique name prefix (ending with an underscore) for each
module, and apply that prefix to all of that module’s externally
visible names. Names of macro parameters, struct and union members,
and parameters in function prototypes are not considered externally
visible for this purpose.</li>
<li>Do not use names that begin with <code class="docutils literal notranslate"><span class="pre">_</span></code>. If you need a name for “internal use
only”, use <code class="docutils literal notranslate"><span class="pre">__</span></code> as a suffix instead of a prefix.</li>
<li>Avoid negative names: <code class="docutils literal notranslate"><span class="pre">found</span></code> is a better name than <code class="docutils literal notranslate"><span class="pre">not_found</span></code>.</li>
<li>In names, a <code class="docutils literal notranslate"><span class="pre">size</span></code> is a count of bytes, a <code class="docutils literal notranslate"><span class="pre">length</span></code> is a count of
characters.  A buffer has size, but a string has length. The length of a
string does not include the null terminator, but the size of the buffer that
contains the string does.</li>
</ul>
</div>
<div class="section" id="comments">
<span id="id3"></span><h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>Comments should be written as full sentences that start with a capital letter
and end with a period. Put two spaces between sentences.</p>
<p>Write block comments as shown below. You may put the <code class="docutils literal notranslate"><span class="pre">/*</span></code> and <code class="docutils literal notranslate"><span class="pre">*/</span></code> on the
same line as comment text if you prefer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">We</span> <span class="n">redirect</span> <span class="n">stderr</span> <span class="n">to</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="n">because</span> <span class="n">we</span> <span class="n">often</span> <span class="n">want</span> <span class="n">to</span> <span class="n">remove</span> <span class="nb">all</span>
 <span class="o">*</span> <span class="n">traffic</span> <span class="n">control</span> <span class="n">configuration</span> <span class="n">on</span> <span class="n">a</span> <span class="n">port</span> <span class="n">so</span> <span class="n">its</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">known</span> <span class="n">state</span><span class="o">.</span>  <span class="n">If</span>
 <span class="o">*</span> <span class="n">this</span> <span class="n">done</span> <span class="n">when</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">such</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">tc</span> <span class="n">complains</span><span class="p">,</span> <span class="n">so</span> <span class="n">we</span> <span class="n">just</span>
 <span class="o">*</span> <span class="n">always</span> <span class="n">ignore</span> <span class="n">it</span><span class="o">.</span>
 <span class="o">*/</span>
</pre></div>
</div>
<p>Each function and each variable declared outside a function, and each struct,
union, and typedef declaration should be preceded by a comment. See <a class="reference internal" href="#functions">functions</a>
below for function comment guidelines.</p>
<p>Each struct and union member should each have an inline comment that explains
its meaning. structs and unions with many members should be additionally
divided into logical groups of members by block comments, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">An</span> <span class="n">event</span> <span class="n">that</span> <span class="n">will</span> <span class="n">wake</span> <span class="n">the</span> <span class="n">following</span> <span class="n">call</span> <span class="n">to</span> <span class="n">poll_block</span><span class="p">()</span><span class="o">.</span> <span class="o">*/</span>
<span class="n">struct</span> <span class="n">poll_waiter</span> <span class="p">{</span>
    <span class="o">/*</span> <span class="n">Set</span> <span class="n">when</span> <span class="n">the</span> <span class="n">waiter</span> <span class="ow">is</span> <span class="n">created</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">struct</span> <span class="n">ovs_list</span> <span class="n">node</span><span class="p">;</span>       <span class="o">/*</span> <span class="n">Element</span> <span class="ow">in</span> <span class="k">global</span> <span class="n">waiters</span> <span class="nb">list</span><span class="o">.</span> <span class="o">*/</span>
    <span class="nb">int</span> <span class="n">fd</span><span class="p">;</span>                     <span class="o">/*</span> <span class="n">File</span> <span class="n">descriptor</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">short</span> <span class="nb">int</span> <span class="n">events</span><span class="p">;</span>           <span class="o">/*</span> <span class="n">Events</span> <span class="n">to</span> <span class="n">wait</span> <span class="k">for</span> <span class="p">(</span><span class="n">POLLIN</span><span class="p">,</span> <span class="n">POLLOUT</span><span class="p">)</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">poll_fd_func</span> <span class="o">*</span><span class="n">function</span><span class="p">;</span>     <span class="o">/*</span> <span class="n">Callback</span> <span class="n">function</span><span class="p">,</span> <span class="k">if</span> <span class="nb">any</span><span class="p">,</span> <span class="ow">or</span> <span class="n">null</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">void</span> <span class="o">*</span><span class="n">aux</span><span class="p">;</span>                  <span class="o">/*</span> <span class="n">Argument</span> <span class="n">to</span> <span class="n">callback</span> <span class="n">function</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">struct</span> <span class="n">backtrace</span> <span class="o">*</span><span class="n">backtrace</span><span class="p">;</span> <span class="o">/*</span> <span class="n">Event</span> <span class="n">that</span> <span class="n">created</span> <span class="n">waiter</span><span class="p">,</span> <span class="ow">or</span> <span class="n">null</span><span class="o">.</span> <span class="o">*/</span>

    <span class="o">/*</span> <span class="n">Set</span> <span class="n">only</span> <span class="n">when</span> <span class="n">poll_block</span><span class="p">()</span> <span class="ow">is</span> <span class="n">called</span><span class="o">.</span> <span class="o">*/</span>
    <span class="n">struct</span> <span class="n">pollfd</span> <span class="o">*</span><span class="n">pollfd</span><span class="p">;</span>      <span class="o">/*</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pollfds</span> <span class="n">array</span>
                                   <span class="p">(</span><span class="n">null</span> <span class="k">if</span> <span class="n">added</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">callback</span><span class="p">)</span><span class="o">.</span> <span class="o">*/</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">XXX</span></code> or <code class="docutils literal notranslate"><span class="pre">FIXME</span></code> comments to mark code that needs work.</p>
<p>Don’t use <code class="docutils literal notranslate"><span class="pre">//</span></code> comments.</p>
<p>Don’t comment out or #if 0 out code. Just remove it. The code that was there
will still be in version control history.</p>
</div>
<div class="section" id="functions">
<span id="id4"></span><h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Put the return type, function name, and the braces that surround the function’s
code on separate lines, all starting in column 0.</p>
<p>Before each function definition, write a comment that describes the function’s
purpose, including each parameter, the return value, and side effects.
References to argument names should be given in single-quotes, e.g. ‘arg’. The
comment should not include the function name, nor need it follow any formal
structure. The comment does not need to describe how a function does its work,
unless this information is needed to use the function correctly (this is often
better done with comments <em>inside</em> the function).</p>
<p>Simple static functions do not need a comment.</p>
<p>Within a file, non-static functions should come first, in the order that they
are declared in the header file, followed by static functions.  Static
functions should be in one or more separate pages (separated by form feed
characters) in logical groups. A commonly useful way to divide groups is by
“level”, with high-level functions first, followed by groups of progressively
lower-level functions. This makes it easy for the program’s reader to see the
top-down structure by reading from top to bottom.</p>
<p>All function declarations and definitions should include a prototype.  Empty
parentheses, e.g. <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">foo();</span></code>, do not include a prototype (they state that
the function’s parameters are unknown); write <code class="docutils literal notranslate"><span class="pre">void</span></code> in parentheses instead,
e.g. <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">foo(void);</span></code>.</p>
<p>Prototypes for static functions should either all go at the top of the file,
separated into groups by blank lines, or they should appear at the top of each
page of functions. Don’t comment individual prototypes, but a comment on each
group of prototypes is often appropriate.</p>
<p>In the absence of good reasons for another order, the following parameter order
is preferred. One notable exception is that data parameters and their
corresponding size parameters should be paired.</p>
<ol class="arabic simple">
<li>The primary object being manipulated, if any (equivalent to the “this”
pointer in C++).</li>
<li>Input-only parameters.</li>
<li>Input/output parameters.</li>
<li>Output-only parameters.</li>
<li>Status parameter.</li>
</ol>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>```
/* Stores the features supported by &#39;netdev&#39; into each of &#39;*current&#39;,
 * &#39;*advertised&#39;, &#39;*supported&#39;, and &#39;*peer&#39; that are non-null.  Each value
 * is a bitmap of &quot;enum ofp_port_features&quot; bits, in host byte order.
 * Returns 0 if successful, otherwise a positive errno value.  On failure,
 * all of the passed-in values are set to 0. */
int
netdev_get_features(struct netdev *netdev,
                    uint32_t *current, uint32_t *advertised,
                    uint32_t *supported, uint32_t *peer)
{
    ...
}
```
</pre></div>
</div>
<p>Functions that destroy an instance of a dynamically-allocated type should
accept and ignore a null pointer argument. Code that calls such a function
(including the C standard library function <code class="docutils literal notranslate"><span class="pre">free()</span></code>) should omit a
null-pointer check. We find that this usually makes code easier to read.</p>
<p>Functions in <code class="docutils literal notranslate"><span class="pre">.c</span></code> files should not normally be marked <code class="docutils literal notranslate"><span class="pre">inline</span></code>, because it
does not usually help code generation and it does suppress compiler warnings
about unused functions. (Functions defined in .h usually should be marked
inline.)</p>
</div>
<div class="section" id="function-prototypes">
<span id="id5"></span><h2>Function Prototypes<a class="headerlink" href="#function-prototypes" title="Permalink to this headline">¶</a></h2>
<p>Put the return type and function name on the same line in a function prototype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">option_class</span> <span class="o">*</span><span class="n">get_option_class</span><span class="p">(</span><span class="nb">int</span> <span class="n">code</span><span class="p">);</span>
</pre></div>
</div>
<p>Omit parameter names from function prototypes when the names do not give useful
information, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">netdev_get_mtu</span><span class="p">(</span><span class="n">const</span> <span class="n">struct</span> <span class="n">netdev</span> <span class="o">*</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="n">mtup</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="statements">
<h2>Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h2>
<p>Indent each level of code with 4 spaces. Use BSD-style brace placement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">b</span><span class="p">();</span>
    <span class="n">d</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Put a space between <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">for</span></code>, etc. and the expressions that
follow them.</p>
<p>Enclose single statements in braces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use comments and blank lines to divide long functions into logical groups of
statements.</p>
<p>Avoid assignments inside <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">while</span></code> conditions.</p>
<p>Do not put gratuitous parentheses around the expression in a return statement,
that is, write <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">0;</span></code> and not <code class="docutils literal notranslate"><span class="pre">return(0);</span></code></p>
<p>Write only one statement per line.</p>
<p>Indent <code class="docutils literal notranslate"><span class="pre">switch</span></code> statements like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">switch</span> <span class="p">(</span><span class="n">conn</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
<span class="n">case</span> <span class="n">S_RECV</span><span class="p">:</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">run_connection_input</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

<span class="n">case</span> <span class="n">S_PROCESS</span><span class="p">:</span>
    <span class="n">error</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>

<span class="n">case</span> <span class="n">S_SEND</span><span class="p">:</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">run_connection_output</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

<span class="n">default</span><span class="p">:</span>
    <span class="n">OVS_NOT_REACHED</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">switch</span></code> statements with very short, uniform cases may use an abbreviated
style:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">switch</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="p">{</span>
<span class="n">case</span> <span class="mi">200</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;OK&quot;</span><span class="p">;</span>
<span class="n">case</span> <span class="mi">201</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Created&quot;</span><span class="p">;</span>
<span class="n">case</span> <span class="mi">202</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Accepted&quot;</span><span class="p">;</span>
<span class="n">case</span> <span class="mi">204</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No Content&quot;</span><span class="p">;</span>
<span class="n">default</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(;;)</span></code> to write an infinite loop.</p>
<p>In an if/else construct where one branch is the “normal” or “common” case and
the other branch is the “uncommon” or “error” case, put the common case after
the “if”, not the “else”. This is a form of documentation. It also places the
most important code in sequential order without forcing the reader to visually
skip past less important details. (Some compilers also assume that the “if”
branch is the more common case, so this can be a real form of optimization as
well.)</p>
</div>
<div class="section" id="return-values">
<h2>Return Values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h2>
<p>For functions that return a success or failure indication, prefer one of the
following return value conventions:</p>
<ul class="simple">
<li>An <code class="docutils literal notranslate"><span class="pre">int</span></code> where 0 indicates success and a positive errno value indicates a
reason for failure.</li>
<li>A <code class="docutils literal notranslate"><span class="pre">bool</span></code> where true indicates success and false indicates failure.</li>
</ul>
</div>
<div class="section" id="macros">
<h2>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h2>
<p>Don’t define an object-like macro if an enum can be used instead.</p>
<p>Don’t define a function-like macro if a “static inline” function can be used
instead.</p>
<p>If a macro’s definition contains multiple statements, enclose them with <code class="docutils literal notranslate"><span class="pre">do</span> <span class="pre">{</span>
<span class="pre">...</span> <span class="pre">}</span> <span class="pre">while</span> <span class="pre">(0)</span></code> to allow them to work properly in all syntactic
circumstances.</p>
<p>Do use macros to eliminate the need to update different parts of a single file
in parallel, e.g. a list of enums and an array that gives the name of each
enum. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Logging</span> <span class="n">importance</span> <span class="n">levels</span><span class="o">.</span> <span class="o">*/</span>
<span class="c1">#define VLOG_LEVELS                             \</span>
    <span class="n">VLOG_LEVEL</span><span class="p">(</span><span class="n">EMER</span><span class="p">,</span> <span class="n">LOG_ALERT</span><span class="p">)</span>                 \
    <span class="n">VLOG_LEVEL</span><span class="p">(</span><span class="n">ERR</span><span class="p">,</span> <span class="n">LOG_ERR</span><span class="p">)</span>                    \
    <span class="n">VLOG_LEVEL</span><span class="p">(</span><span class="n">WARN</span><span class="p">,</span> <span class="n">LOG_WARNING</span><span class="p">)</span>               \
    <span class="n">VLOG_LEVEL</span><span class="p">(</span><span class="n">INFO</span><span class="p">,</span> <span class="n">LOG_NOTICE</span><span class="p">)</span>                \
    <span class="n">VLOG_LEVEL</span><span class="p">(</span><span class="n">DBG</span><span class="p">,</span> <span class="n">LOG_DEBUG</span><span class="p">)</span>
<span class="n">enum</span> <span class="n">vlog_level</span> <span class="p">{</span>
<span class="c1">#define VLOG_LEVEL(NAME, SYSLOG_LEVEL) VLL_##NAME,</span>
    <span class="n">VLOG_LEVELS</span>
<span class="c1">#undef VLOG_LEVEL</span>
    <span class="n">VLL_N_LEVELS</span>
<span class="p">};</span>

<span class="o">/*</span> <span class="n">Name</span> <span class="k">for</span> <span class="n">each</span> <span class="n">logging</span> <span class="n">level</span><span class="o">.</span> <span class="o">*/</span>
<span class="n">static</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">level_names</span><span class="p">[</span><span class="n">VLL_N_LEVELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">#define VLOG_LEVEL(NAME, SYSLOG_LEVEL) #NAME,</span>
    <span class="n">VLOG_LEVELS</span>
<span class="c1">#undef VLOG_LEVEL</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="thread-safety-annotations">
<h2>Thread Safety Annotations<a class="headerlink" href="#thread-safety-annotations" title="Permalink to this headline">¶</a></h2>
<p>Use the macros in <code class="docutils literal notranslate"><span class="pre">lib/compiler.h</span></code> to annotate locking requirements. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">struct</span> <span class="n">ovs_mutex</span> <span class="n">mutex</span> <span class="o">=</span> <span class="n">OVS_MUTEX_INITIALIZER</span><span class="p">;</span>
<span class="n">static</span> <span class="n">struct</span> <span class="n">ovs_rwlock</span> <span class="n">rwlock</span> <span class="o">=</span> <span class="n">OVS_RWLOCK_INITIALIZER</span><span class="p">;</span>

<span class="n">void</span> <span class="n">function_require_plain_mutex</span><span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="n">OVS_REQUIRES</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<span class="n">void</span> <span class="n">function_require_rwlock</span><span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="n">OVS_REQ_RDLOCK</span><span class="p">(</span><span class="n">rwlock</span><span class="p">);</span>
</pre></div>
</div>
<p>Pass lock objects, not their addresses, to the annotation macros. (Thus we have
<code class="docutils literal notranslate"><span class="pre">OVS_REQUIRES(mutex)</span></code> above, not <code class="docutils literal notranslate"><span class="pre">OVS_REQUIRES(&amp;mutex)</span></code>.)</p>
</div>
<div class="section" id="source-files">
<span id="id6"></span><h2>Source Files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h2>
<p>Each source file should state its license in a comment at the very top,
followed by a comment explaining the purpose of the code that is in that file.
The comment should explain how the code in the file relates to code in other
files. The goal is to allow a programmer to quickly figure out where a given
module fits into the larger system.</p>
<p>The first non-comment line in a .c source file should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;config.h&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">#include</span></code> directives should appear in the following order:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;config.h&gt;</span></code></li>
<li>The module’s own headers, if any. Including this before any other header
(besides ) ensures that the module’s header file is self-contained (see
<a class="reference internal" href="#header-files">header files</a> below).</li>
<li>Standard C library headers and other system headers, preferably in
alphabetical order. (Occasionally one encounters a set of system headers
that must be included in a particular order, in which case that order must
take precedence.)</li>
<li>Open vSwitch headers, in alphabetical order. Use <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, not <code class="docutils literal notranslate"><span class="pre">&lt;&gt;</span></code>, to
specify Open vSwitch header names.</li>
</ol>
</div>
<div class="section" id="header-files">
<span id="id7"></span><h2>Header Files<a class="headerlink" href="#header-files" title="Permalink to this headline">¶</a></h2>
<p>Each header file should start with its license, as described under <a class="reference internal" href="#source-files">source
files</a> above, followed by a “header guard” to make the header file idempotent,
like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifndef NETDEV_H</span>
<span class="c1">#define NETDEV_H 1</span>

<span class="o">...</span>

<span class="c1">#endif /* netdev.h */</span>
</pre></div>
</div>
<p>Header files should be self-contained; that is, they should <code class="docutils literal notranslate"><span class="pre">#include</span></code> whatever
additional headers are required, without requiring the client to <code class="docutils literal notranslate"><span class="pre">#include</span></code>
them for it.</p>
<p>Don’t define the members of a struct or union in a header file, unless client
code is actually intended to access them directly or if the definition is
otherwise actually needed (e.g. inline functions defined in the header need
them).</p>
<p>Similarly, don’t <code class="docutils literal notranslate"><span class="pre">#include</span></code> a header file just for the declaration of a
struct or union tag (e.g. just for <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">;</span></code>). Just declare the tag
yourself.  This reduces the number of header file dependencies.</p>
</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>Use typedefs sparingly. Code is clearer if the actual type is visible at the
point of declaration. Do not, in general, declare a typedef for a struct,
union, or enum. Do not declare a typedef for a pointer type, because this can
be very confusing to the reader.</p>
<p>A function type is a good use for a typedef because it can clarify code.  The
type should be a function type, not a pointer-to-function type. That way, the
typedef name can be used to declare function prototypes. (It cannot be used for
function definitions, because that is explicitly prohibited by C89 and C99.)</p>
<p>You may assume that <code class="docutils literal notranslate"><span class="pre">char</span></code> is exactly 8 bits and that <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">long</span></code>
are at least 32 bits.</p>
<p>Don’t assume that <code class="docutils literal notranslate"><span class="pre">long</span></code> is big enough to hold a pointer. If you need to cast
a pointer to an integer, use <code class="docutils literal notranslate"><span class="pre">intptr_t</span></code> or <code class="docutils literal notranslate"><span class="pre">uintptr_t</span></code> from .</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">int_t</span></code> and <code class="docutils literal notranslate"><span class="pre">uint_t</span></code> types from for exact-width integer types. Use
the <code class="docutils literal notranslate"><span class="pre">PRId</span></code>, <code class="docutils literal notranslate"><span class="pre">PRIu</span></code>, and <code class="docutils literal notranslate"><span class="pre">PRIx</span></code> macros from for formatting them with
<code class="docutils literal notranslate"><span class="pre">printf()</span></code> and related functions.</p>
<p>For compatibility with antique <code class="docutils literal notranslate"><span class="pre">printf()</span></code> implementations:</p>
<ul class="simple">
<li>Instead of <code class="docutils literal notranslate"><span class="pre">&quot;%zu&quot;</span></code>, use <code class="docutils literal notranslate"><span class="pre">&quot;%&quot;PRIuSIZE</span></code>.</li>
<li>Instead of <code class="docutils literal notranslate"><span class="pre">&quot;%td&quot;</span></code>, use <code class="docutils literal notranslate"><span class="pre">&quot;%&quot;PRIdPTR</span></code>.</li>
<li>Instead of <code class="docutils literal notranslate"><span class="pre">&quot;%ju&quot;</span></code>, use <code class="docutils literal notranslate"><span class="pre">&quot;%&quot;PRIuMAX</span></code>.</li>
</ul>
<p>Other variants exist for different radixes. For example, use <code class="docutils literal notranslate"><span class="pre">&quot;%&quot;PRIxSIZE</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">&quot;%zx&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;%x&quot;</span></code> instead of <code class="docutils literal notranslate"><span class="pre">&quot;%hhx&quot;</span></code>.</p>
<p>Also, instead of <code class="docutils literal notranslate"><span class="pre">&quot;%hhd&quot;</span></code>, use <code class="docutils literal notranslate"><span class="pre">&quot;%d&quot;</span></code>. Be cautious substituting <code class="docutils literal notranslate"><span class="pre">&quot;%u&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;%x&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;%o&quot;</span></code> for the corresponding versions with <code class="docutils literal notranslate"><span class="pre">&quot;hh&quot;</span></code>: cast the
argument to unsigned char if necessary, because <code class="docutils literal notranslate"><span class="pre">printf(&quot;%hhu&quot;,</span> <span class="pre">-1)</span></code> prints
255 but <code class="docutils literal notranslate"><span class="pre">printf(&quot;%u&quot;,</span> <span class="pre">-1)</span></code> prints 4294967295.</p>
<p>Use bit-fields sparingly. Do not use bit-fields for layout of network
protocol fields or in other circumstances where the exact format is
important.</p>
<p>Declare bit-fields to be signed or unsigned integer types or _Bool (aka
bool). Do <em>not</em> declare bit-fields of type <code class="docutils literal notranslate"><span class="pre">int</span></code>: C99 allows these to be
either signed or unsigned according to the compiler’s whim. (A 1-bit bit-field
of type <code class="docutils literal notranslate"><span class="pre">int</span></code> may have a range of -1…0!)</p>
<p>Try to order structure members such that they pack well on a system with 2-byte
<code class="docutils literal notranslate"><span class="pre">short</span></code>, 4-byte <code class="docutils literal notranslate"><span class="pre">int</span></code>, and 4- or 8-byte <code class="docutils literal notranslate"><span class="pre">long</span></code> and pointer types.  Prefer
clear organization over size optimization unless you are convinced there is a
size or speed benefit.</p>
<p>Pointer declarators bind to the variable name, not the type name. Write
<code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*x</span></code>, not <code class="docutils literal notranslate"><span class="pre">int*</span> <span class="pre">x</span></code> and definitely not <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*</span> <span class="pre">x</span></code>.</p>
</div>
<div class="section" id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<p>Put one space on each side of infix binary and ternary operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>* / %
+ -
&lt;&lt; &gt;&gt;
&lt; &lt;= &gt; &gt;=
== !=
&amp;
^
|
&amp;&amp;
||
?:
= += -= *= /= %= &amp;= ^= |= &lt;&lt;= &gt;&gt;=
</pre></div>
</div>
<p>Avoid comma operators.</p>
<p>Do not put any white space around postfix, prefix, or grouping operators:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>() [] -&gt; .
! ~ ++ -- + - * &amp;
</pre></div>
</div>
<p>Exception 1: Put a space after (but not before) the “sizeof” keyword.</p>
<p>Exception 2: Put a space between the () used in a cast and the expression whose
type is cast: <code class="docutils literal notranslate"><span class="pre">(void</span> <span class="pre">\*)</span> <span class="pre">0</span></code>.</p>
<p>Break long lines before the ternary operators ? and :, rather than after
them, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>return (out_port != VIGP_CONTROL_PATH
        ? alpheus_output_port(dp, skb, out_port)
        : alpheus_output_control(dp, skb, fwd_save_skb(skb),
                                 VIGR_ACTION));
</pre></div>
</div>
<p>Parenthesize the operands of <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> and <code class="docutils literal notranslate"><span class="pre">||</span></code> if operator precedence makes it
necessary, or if the operands are themselves expressions that use <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> and
<code class="docutils literal notranslate"><span class="pre">||</span></code>, but not otherwise. Thus:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (rule &amp;&amp; (!best || rule-&gt;priority &gt; best-&gt;priority)) {
    best = rule;
}
</pre></div>
</div>
<p>but:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (!isdigit((unsigned char)s[0]) ||
    !isdigit((unsigned char)s[1]) ||
    !isdigit((unsigned char)s[2])) {
    printf(&quot;string %s does not start with 3-digit code\n&quot;, s);
}
</pre></div>
</div>
<p>Do parenthesize a subexpression that must be split across more than one line,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span><span class="n">idxp</span> <span class="o">=</span> <span class="p">((</span><span class="n">l1_idx</span> <span class="o">&lt;&lt;</span> <span class="n">PORT_ARRAY_L1_SHIFT</span><span class="p">)</span> <span class="o">|</span>
         <span class="p">(</span><span class="n">l2_idx</span> <span class="o">&lt;&lt;</span> <span class="n">PORT_ARRAY_L2_SHIFT</span><span class="p">)</span> <span class="o">|</span>
         <span class="p">(</span><span class="n">l3_idx</span> <span class="o">&lt;&lt;</span> <span class="n">PORT_ARRAY_L3_SHIFT</span><span class="p">));</span>
</pre></div>
</div>
<p>Breaking a long line after a binary operator gives its operands a more
consistent look, since each operand has the same horizontal position.  This
makes the end-of-line position a good choice when the operands naturally
resemble each other, as in the previous two examples.  On the other hand,
breaking before a binary operator better draws the eye to the operator, which
can help clarify code by making it more obvious what’s happening, such as in
the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (!ctx.freezing
    &amp;&amp; xbridge-&gt;has_in_band
    &amp;&amp; in_band_must_output_to_local_port(flow)
    &amp;&amp; !actions_output_to_local_port(&amp;ctx)) {
</pre></div>
</div>
<p>Thus, decide whether to break before or after a binary operator separately in
each situation, based on which of these factors appear to be more important.</p>
<p>Try to avoid casts. Don’t cast the return value of malloc().</p>
<p>The “sizeof” operator is unique among C operators in that it accepts two very
different kinds of operands: an expression or a type. In general, prefer to
specify an expression, e.g. <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*x</span> <span class="pre">=</span> <span class="pre">xmalloc(sizeof</span> <span class="pre">*\</span> <span class="pre">x);</span></code>. When the
operand of sizeof is an expression, there is no need to parenthesize that
operand, and please don’t.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">ARRAY_SIZE</span></code> macro from <code class="docutils literal notranslate"><span class="pre">lib/util.h</span></code> to calculate the number of
elements in an array.</p>
<p>When using a relational operator like <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> or <code class="docutils literal notranslate"><span class="pre">==</span></code>, put an expression or
variable argument on the left and a constant argument on the right, e.g.
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">0</span></code>, <em>not</em> <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">==</span> <span class="pre">x</span></code>.</p>
</div>
<div class="section" id="blank-lines">
<h2>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this headline">¶</a></h2>
<p>Put one blank line between top-level definitions of functions and global
variables.</p>
</div>
<div class="section" id="c-dialect">
<h2>C DIALECT<a class="headerlink" href="#c-dialect" title="Permalink to this headline">¶</a></h2>
<p>Most C99 features are OK because they are widely implemented:</p>
<ul>
<li><p class="first">Flexible array members (e.g. <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">{</span> <span class="pre">int</span> <span class="pre">foo[];</span> <span class="pre">}</span></code>).</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">inline</span></code> functions (but no other forms of <code class="docutils literal notranslate"><span class="pre">inline</span></code>, for which GCC
and C99 have differing interpretations).</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bool</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;stdbool.h&gt;</span></code>, but don’t assume that bool or _Bool can only
take on the values 0 or 1, because this behavior can’t be simulated on C89
compilers.</p>
<p>Also, don’t assume that a conversion to <code class="docutils literal notranslate"><span class="pre">bool</span></code> or <code class="docutils literal notranslate"><span class="pre">_Bool</span></code> follows C99
semantics, i.e. use <code class="docutils literal notranslate"><span class="pre">(bool)(some_value</span> <span class="pre">!=</span> <span class="pre">0)</span></code> rather than
<code class="docutils literal notranslate"><span class="pre">(bool)some_value</span></code>. The latter might produce unexpected results on non-C99
environments. For example, if bool is implemented as a typedef of char and
<code class="docutils literal notranslate"><span class="pre">some_value</span> <span class="pre">=</span> <span class="pre">0x10000000</span></code>.</p>
</li>
<li><p class="first">Designated initializers (e.g. <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">foo</span> <span class="pre">foo</span> <span class="pre">=</span> <span class="pre">{.a</span> <span class="pre">=</span> <span class="pre">1};</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span>
<span class="pre">a[]</span> <span class="pre">=</span> <span class="pre">{[2]</span> <span class="pre">=</span> <span class="pre">5};</span></code>).</p>
</li>
<li><p class="first">Mixing of declarations and code within a block.  Favor positioning that
allows variables to be initialized at their point of declaration.</p>
</li>
<li><p class="first">Use of declarations in iteration statements (e.g. <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">(int</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span>
<span class="pre">&lt;</span> <span class="pre">10;</span> <span class="pre">i++)</span></code>).</p>
</li>
<li><p class="first">Use of a trailing comma in an enum declaration (e.g. <code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">1,</span>
<span class="pre">};</span></code>).</p>
</li>
</ul>
<p>As a matter of style, avoid <code class="docutils literal notranslate"><span class="pre">//</span></code> comments.</p>
<p>Avoid using GCC or Clang extensions unless you also add a fallback for other
compilers. You can, however, use C99 features or GCC extensions also supported
by Clang in code that compiles only on GNU/Linux (such as
<code class="docutils literal notranslate"><span class="pre">lib/netdev-linux.c</span></code>), because GCC is the system compiler there.</p>
</div>
<div class="section" id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<p>When introducing new Python code, try to follow Python’s <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> style. Consider running the
<code class="docutils literal notranslate"><span class="pre">pep8</span></code> or <code class="docutils literal notranslate"><span class="pre">flake8</span></code> tool against your code to find issues.</p>
</div>
<div class="section" id="libraries">
<h2>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h2>
<p>When introducing a new library, follow
<a class="reference internal" href="libopenvswitch-abi.html"><span class="doc">Open vSwitch Library ABI guide</span></a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../contents.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Open vSwitch Coding Style</a><ul>
<li><a class="reference internal" href="#basics">Basics</a></li>
<li><a class="reference internal" href="#naming">Naming</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#function-prototypes">Function Prototypes</a></li>
<li><a class="reference internal" href="#statements">Statements</a></li>
<li><a class="reference internal" href="#return-values">Return Values</a></li>
<li><a class="reference internal" href="#macros">Macros</a></li>
<li><a class="reference internal" href="#thread-safety-annotations">Thread Safety Annotations</a></li>
<li><a class="reference internal" href="#source-files">Source Files</a></li>
<li><a class="reference internal" href="#header-files">Header Files</a></li>
<li><a class="reference internal" href="#types">Types</a></li>
<li><a class="reference internal" href="#expressions">Expressions</a></li>
<li><a class="reference internal" href="#blank-lines">Blank Lines</a></li>
<li><a class="reference internal" href="#c-dialect">C DIALECT</a></li>
<li><a class="reference internal" href="#python">Python</a></li>
<li><a class="reference internal" href="#libraries">Libraries</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../contents.html">Documentation overview</a><ul>
  <li><a href="../index.html">Open vSwitch Internals</a><ul>
  <li><a href="index.html">Contributing to Open vSwitch</a><ul>
      <li>Previous: <a href="backporting-patches.html" title="previous chapter">Backporting patches</a></li>
      <li>Next: <a href="coding-style-windows.html" title="next chapter">Open vSwitch Windows Datapath Coding Style</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/internals/contributing/coding-style.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, The Open vSwitch Development Community.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../_sources/internals/contributing/coding-style.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>